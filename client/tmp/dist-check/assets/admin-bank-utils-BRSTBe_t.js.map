{"version":3,"file":"admin-bank-utils-BRSTBe_t.js","sources":["../../../src/lib/admin-bank-utils.ts"],"sourcesContent":["import { derivePassword } from '@/lib/bank-utils';\nimport { supabase } from '@/lib/supabase';\nimport type { AdminBank } from '@/components/sampler/types/sampler';\n\n// Create admin bank, then derive key from the created DB id, update row, and return final row.\nexport async function createAdminBankWithDerivedKey(\n  title: string,\n  description: string,\n  createdBy: string,\n  color?: string,\n): Promise<AdminBank | null> {\n  try {\n    let created: any = null;\n    let insertErr: any = null;\n    {\n      const attempt = await supabase\n        .from('banks')\n        .insert({\n          title,\n          description,\n          created_by: createdBy,\n          ...(color ? { color } : {}),\n        })\n        .select('*')\n        .single();\n      created = attempt.data;\n      insertErr = attempt.error;\n      if (insertErr && color && /column .*color/i.test(insertErr.message || '')) {\n        const fallback = await supabase\n          .from('banks')\n          .insert({\n            title,\n            description,\n            created_by: createdBy,\n          })\n          .select('*')\n          .single();\n        created = fallback.data;\n        insertErr = fallback.error;\n      }\n    }\n\n    if (insertErr || !created) {\n      console.error('[BANK][EXPORT] Insert failed', insertErr);\n      return null;\n    }\n\n    const bankId: string = created.id;\n    const derivedKey = await derivePassword(bankId);\n\n    const { data: updated, error: updateErr } = await supabase\n      .from('banks')\n      .update({ derived_key: derivedKey })\n      .eq('id', bankId)\n      .select('*')\n      .single();\n\n    if (updateErr || !updated) {\n      console.error('[BANK][EXPORT] Update derived_key failed', updateErr);\n      return null;\n    }\n\n    return updated as AdminBank;\n  } catch (error) {\n    console.error('Error creating admin bank with derived key:', error);\n    return null;\n  }\n}\n"],"names":["async","createAdminBankWithDerivedKey","title","description","createdBy","color","created","insertErr","attempt","supabase","from","insert","created_by","select","single","data","error","test","message","fallback","console","bankId","id","derivedKey","derivePassword","updated","updateErr","update","derived_key","eq"],"mappings":"2LAKAA,eAAsBC,EACpBC,EACAC,EACAC,EACAC,GAEI,IACF,IAAIC,EAAe,KACfC,EAAiB,KACrB,CACE,MAAMC,QAAgBC,EACnBC,KAAK,SACLC,OAAO,CACNT,QACAC,cACAS,WAAYR,KACRC,EAAQ,CAAEA,SAAU,CAAA,IAEzBQ,OAAO,KACPC,SAGH,GAFAR,EAAUE,EAAQO,KAClBR,EAAYC,EAAQQ,MAChBT,GAAaF,GAAS,kBAAkBY,KAAKV,EAAUW,SAAW,IAAK,CACzE,MAAMC,QAAiBV,EACpBC,KAAK,SACLC,OAAO,CACNT,QACAC,cACAS,WAAYR,IAEbS,OAAO,KACPC,SACHR,EAAUa,EAASJ,KACnBR,EAAYY,EAASH,KAAA,CACvB,CAGE,GAAAT,IAAcD,EAET,OADCc,QAAAJ,MAAM,+BAAgCT,GACvC,KAGT,MAAMc,EAAiBf,EAAQgB,GACzBC,QAAmBC,EAAeH,IAEhCN,KAAMU,EAAST,MAAOU,SAAoBjB,EAC/CC,KAAK,SACLiB,OAAO,CAAEC,YAAaL,IACtBM,GAAG,KAAMR,GACTR,OAAO,KACPC,SAEC,OAAAY,IAAcD,GACRL,QAAAJ,MAAM,2CAA4CU,GACnD,MAGFD,QACAT,GAEA,OADCI,QAAAJ,MAAM,8CAA+CA,GACtD,IAAA,CAEX"}