import{r as e,j as a}from"./ui-vendor-DQigaf8h.js";import{B as s,L as n,S as t}from"./index-CH2onsZE.js";import{X as l,r as d,C as r,b as i,x as o,L as c,f as x,P as h,S as m,e as u,y as p,W as g}from"./utils-vendor-Dm3UHTo7.js";import"./react-vendor-ClOJDe5F.js";import"./supabase-vendor-BjTeASSi.js";const b=[0,1,2,3],y=e=>{const a=Math.max(0,Math.floor(e/1e3));return`${Math.floor(a/60).toString().padStart(2,"0")}:${(a%60).toString().padStart(2,"0")}`},v=(e,a,s)=>Math.max(a,Math.min(s,e)),j=e=>({channelId:e,loadedPadRef:null,isPlaying:!1,isPaused:!1,playheadMs:0,durationMs:0,channelVolume:1,hotcuesMs:[null,null,null,null],hasLocalHotcueOverride:!1,collapsed:!1,waveformKey:null,pad:null});function N({open:N,onOpenChange:f,channelStates:k,channelCount:w,legacyPlayingPads:C,banks:I,masterVolume:M,onMasterVolumeChange:P,onPadVolumeChange:S,onStopPad:$,onChannelVolumeChange:V,onStopChannel:E,onPlayChannel:T,onPauseChannel:z,onSeekChannel:L,onUnloadChannel:H,onLoadPadToChannel:R,onSetChannelHotcue:B,onTriggerChannelHotcue:O,onSaveChannelHotcuesToPad:q,onSetChannelCollapsed:U,stopMode:J,editMode:A,eqSettings:D,onEqChange:W,mixerEqCollapsed:F,onMixerEqCollapsedChange:K,theme:Q,windowWidth:X}){const[G,Y]=e.useState({}),[Z,_]=e.useState({}),ee=X<768,ae=e.useMemo(()=>{const e=new Map;return k.forEach(a=>e.set(a.channelId,a)),e},[k]),se=e.useMemo(()=>{const e=[];for(let a=1;a<=w;a+=1)e.push(ae.get(a)||j(a));return e},[w,ae]),ne=e.useMemo(()=>{const e=new Map;return I.forEach(a=>e.set(a.id,a)),e},[I]);e.useEffect(()=>{Y(e=>{const a={...e};return se.forEach(e=>{var s,n,t;const l=a[e.channelId];if((null==l?void 0:l.bankId)&&(null==l?void 0:l.padId))return;if((null==(s=e.loadedPadRef)?void 0:s.bankId)&&(null==(n=e.loadedPadRef)?void 0:n.padId))return void(a[e.channelId]={bankId:e.loadedPadRef.bankId,padId:e.loadedPadRef.padId});const d=I.find(e=>e.pads.length>0);a[e.channelId]=d?{bankId:d.id,padId:(null==(t=d.pads[0])?void 0:t.id)||""}:{bankId:"",padId:""}}),a})},[I,se]);const te=e.useCallback((e,a)=>{Y(s=>{var n;const t=ne.get(a);return{...s,[e]:{bankId:a,padId:(null==(n=null==t?void 0:t.pads[0])?void 0:n.id)||""}}})},[ne]),le=e.useCallback((e,a)=>{Y(s=>{var n;return{...s,[e]:{bankId:(null==(n=s[e])?void 0:n.bankId)||"",padId:a}}})},[]),de=e.useCallback(async e=>{const a=G[e];if((null==a?void 0:a.bankId)&&(null==a?void 0:a.padId)){_(a=>({...a,[e]:!0}));try{await R(e,a.bankId,a.padId)}finally{_(a=>({...a,[e]:!1}))}}},[G,R]),re=e.useCallback((e,a)=>{var s;const n=Math.max(1,(null==(s=a.pad)?void 0:s.endMs)||a.durationMs||0);if(n<=1)return;const t=e.currentTarget.getBoundingClientRect(),l=v(e.clientX-t.left,0,t.width),d=t.width>0?l/t.width:0;L(a.channelId,d*n)},[L]),ie=e.useCallback((e,a)=>{if(A){const s=e.hotcuesMs[a];return void B(e.channelId,a,"number"==typeof s?null:Math.max(0,e.playheadMs||0))}O(e.channelId,a)},[A,B,O]),oe="dark"===Q?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-200 text-gray-900",ce="dark"===Q?"bg-gray-900/70 border-gray-700":"bg-gray-50 border-gray-200";return a.jsxs("div",{className:`fixed inset-y-0 right-0 z-50 w-[28rem] max-w-[95vw] border-l shadow-2xl transition-transform duration-300 ${oe} ${N?"translate-x-0":"translate-x-full"}`,children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b "+("dark"===Q?"border-gray-700":"border-gray-200"),children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-sm font-semibold",children:"Mixer Engine V2"}),a.jsxs("p",{className:"text-[11px] "+("dark"===Q?"text-gray-400":"text-gray-500"),children:[w," loadable channels, stop mode: ",J]})]}),a.jsx(s,{variant:"outline",size:"icon",onClick:()=>f(!1),className:"dark"===Q?"h-8 w-8 border-red-500/60 bg-red-900/30 text-red-300 hover:bg-red-800/60":"h-8 w-8 border-red-300 bg-red-50 text-red-600 hover:bg-red-100",title:"Close Mixer",children:a.jsx(l,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"h-[calc(100vh-64px)] overflow-y-auto p-3 space-y-3",children:[A&&a.jsxs("div",{className:"rounded-md border px-3 py-2 text-xs font-semibold tracking-wide "+("dark"===Q?"border-amber-500 bg-amber-600/20 text-amber-200":"border-amber-400 bg-amber-50 text-amber-800"),children:["HOTCUE SET MODE ACTIVE",a.jsx("div",{className:"mt-1 text-[11px] font-normal "+("dark"===Q?"text-amber-100/90":"text-amber-700"),children:"Tap hotcue buttons to set/clear cues. Jump is disabled while Edit Mode is active."})]}),a.jsxs("section",{className:`rounded-lg border p-3 ${ce}`,children:[a.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[a.jsxs(n,{className:"text-xs font-semibold flex items-center gap-2",children:[a.jsx(d,{className:"h-4 w-4"})," Master and EQ"]}),a.jsx(s,{type:"button",variant:"outline",size:"sm",className:"h-7 px-2",onClick:()=>K(!F),children:F?a.jsx(r,{className:"h-4 w-4"}):a.jsx(i,{className:"h-4 w-4"})})]}),!F&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["Master Volume ",Math.round(100*M),"%"]}),a.jsx(t,{value:[100*M],onValueChange:([e])=>P(e/100),min:0,max:100,step:1})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["High ",D.high>0?"+":"",D.high,"dB"]}),a.jsx(t,{value:[D.high],onValueChange:([e])=>W({...D,high:e}),min:-12,max:12,step:1})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["Mid ",D.mid>0?"+":"",D.mid,"dB"]}),a.jsx(t,{value:[D.mid],onValueChange:([e])=>W({...D,mid:e}),min:-12,max:12,step:1})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["Low ",D.low>0?"+":"",D.low,"dB"]}),a.jsx(t,{value:[D.low],onValueChange:([e])=>W({...D,low:e}),min:-12,max:12,step:1})]})]})]}),a.jsxs("section",{className:`rounded-lg border p-3 ${ce}`,children:[a.jsxs(n,{className:"text-xs font-semibold flex items-center gap-2 mb-2",children:[a.jsx(o,{className:"h-4 w-4"}),"Channel Decks"]}),a.jsx("div",{className:"space-y-2",children:se.map(e=>{var n;const l=Boolean(e.pad&&e.loadedPadRef),d=Math.max(1,(null==(n=e.pad)?void 0:n.endMs)||e.durationMs||0),o=v(e.playheadMs||0,0,d),g=d>0?o/d*100:0,j=G[e.channelId]||{bankId:"",padId:""},N=ne.get(j.bankId),f=Boolean(Z[e.channelId]);return a.jsxs("div",{className:"rounded-md border p-2 "+("dark"===Q?"border-gray-700 bg-gray-950/40":"border-gray-200 bg-white"),children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsxs("div",{className:"text-[11px] font-semibold "+("dark"===Q?"text-gray-200":"text-gray-700"),children:["CH ",e.channelId]}),a.jsx("div",{className:"min-w-0 flex-1 text-xs truncate",children:e.pad?`${e.pad.padName} (${e.pad.bankName})`:"No sampler loaded"}),a.jsx(s,{type:"button",variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>U(e.channelId,!e.collapsed),title:e.collapsed?"Expand channel":"Collapse channel",children:e.collapsed?a.jsx(r,{className:"h-4 w-4"}):a.jsx(i,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"grid grid-cols-[1fr,1fr,auto] gap-2 mb-2",children:[a.jsxs("select",{value:j.bankId,onChange:a=>te(e.channelId,a.target.value),className:"h-8 rounded border px-2 text-xs "+("dark"===Q?"bg-gray-900 border-gray-700 text-gray-100":"bg-white border-gray-300 text-gray-900"),children:[0===I.length&&a.jsx("option",{value:"",children:"No banks"}),I.map(s=>a.jsx("option",{value:s.id,children:s.name},`${e.channelId}-${s.id}`))]}),a.jsxs("select",{value:j.padId,onChange:a=>le(e.channelId,a.target.value),className:"h-8 rounded border px-2 text-xs "+("dark"===Q?"bg-gray-900 border-gray-700 text-gray-100":"bg-white border-gray-300 text-gray-900"),disabled:!N||0===N.pads.length,children:[!N&&a.jsx("option",{value:"",children:"Select bank"}),N&&0===N.pads.length&&a.jsx("option",{value:"",children:"No pads"}),null==N?void 0:N.pads.map(s=>a.jsx("option",{value:s.id,children:s.name},`${e.channelId}-${s.id}`))]}),a.jsx(s,{type:"button",variant:"outline",size:"sm",className:"h-8 px-2",onClick:()=>{de(e.channelId)},disabled:f||!j.bankId||!j.padId,children:f?a.jsx(c,{className:"h-4 w-4 animate-spin"}):"Load"})]}),a.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[a.jsx(s,{type:"button",variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>e.isPlaying?z(e.channelId):T(e.channelId),disabled:!l,title:e.isPlaying?"Pause":"Play",children:e.isPlaying?a.jsx(x,{className:"h-4 w-4"}):a.jsx(h,{className:"h-4 w-4"})}),a.jsx(s,{type:"button",variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>E(e.channelId),disabled:!l,title:"Stop",children:a.jsx(m,{className:"h-4 w-4"})}),a.jsx(s,{type:"button",variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>H(e.channelId),disabled:!l,title:"Unload",children:a.jsx(u,{className:"h-4 w-4"})}),a.jsxs("div",{className:"min-w-0 flex-1 text-[11px] text-right text-gray-500 dark:text-gray-400",children:[y(o)," / ",y(d)]})]}),a.jsxs("div",{className:"relative h-10 rounded border cursor-pointer overflow-hidden mb-2 "+("dark"===Q?"border-gray-700 bg-gray-900":"border-gray-300 bg-gray-100"),onClick:a=>re(a,e),title:l?"Seek using waveform":"Load a sampler first",children:[a.jsx("div",{className:"absolute inset-0 "+("dark"===Q?"bg-gradient-to-r from-blue-900/40 to-cyan-700/40":"bg-gradient-to-r from-blue-200 to-cyan-100")}),a.jsx("div",{className:"absolute inset-y-0 left-0 "+("dark"===Q?"bg-cyan-300/30":"bg-cyan-400/30"),style:{width:`${g}%`}}),a.jsx("div",{className:"absolute inset-y-0 w-[2px] "+("dark"===Q?"bg-cyan-300":"bg-cyan-600"),style:{left:`${g}%`}})]}),a.jsxs("div",{className:"space-y-2",children:[!e.collapsed&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid grid-cols-4 gap-1",children:b.map(n=>{const t=e.hotcuesMs[n],d="number"==typeof t;return a.jsx(s,{type:"button",variant:"outline",size:"sm",className:"h-8 px-0 text-[11px] "+(A?d?"border-amber-500 bg-amber-500/30 text-amber-100":"border-amber-400/70 text-amber-300":d?"border-cyan-400/80 text-cyan-400":""),onClick:()=>ie(e,n),disabled:!l,title:A?d?"Tap to clear cue":"Tap to set cue at current playhead":d?`Jump to ${y(t||0)}`:"No cue set",children:d?`C${n+1}`:"-"},`${e.channelId}-hotcue-${n}`)})}),a.jsx("div",{className:"text-[10px] text-gray-500 dark:text-gray-400",children:A?"Tap to SET/CLEAR cue.":"Tap to JUMP to cue."}),A&&l&&e.hasLocalHotcueOverride&&a.jsxs(s,{type:"button",variant:"outline",size:"sm",className:"h-8 w-full text-[11px]",onClick:()=>q(e.channelId),children:[a.jsx(p,{className:"mr-1 h-3.5 w-3.5"})," Save Channel Cues to Pad"]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 dark:text-gray-400",children:[a.jsx("span",{children:"Channel Volume"}),a.jsxs("span",{children:[Math.round(100*e.channelVolume),"%"]})]}),a.jsx(t,{value:[100*e.channelVolume],min:0,max:100,step:1,onValueChange:([a])=>V(e.channelId,a/100)})]})]})]},e.channelId)})})]}),a.jsxs("section",{className:`rounded-lg border p-3 ${ce}`,children:[a.jsxs(n,{className:"text-xs font-semibold flex items-center gap-2 mb-2",children:[a.jsx(g,{className:"h-4 w-4"})," Current Playing Sampler"]}),a.jsxs("div",{className:"space-y-2 max-h-56 overflow-y-auto",children:[0===C.length&&a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"No pad-grid playback running."}),C.map(e=>{const n=Math.max(1,e.endMs||0),l=v(e.currentMs||0,0,n);return a.jsxs("div",{className:"rounded-md border p-2 "+("dark"===Q?"border-gray-700 bg-gray-950/40":"border-gray-200 bg-white"),children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"text-xs font-medium truncate",children:e.padName}),a.jsx("div",{className:"text-[10px] text-gray-500 dark:text-gray-400 truncate",children:e.bankName})]}),a.jsx(s,{type:"button",variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>$(e.padId),title:"Stop pad",children:a.jsx(m,{className:"h-4 w-4"})})]}),!ee&&a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 dark:text-gray-400",children:[a.jsxs("span",{children:[y(l)," / ",y(n)]}),a.jsxs("span",{children:[Math.round(100*(e.effectiveVolume??e.volume)),"%"]})]}),a.jsx(t,{value:[100*e.volume],min:0,max:100,step:1,onValueChange:([a])=>S(e.padId,a/100)})]})]},e.padId)})]})]})]})]})}export{N as VolumeMixer};
//# sourceMappingURL=VolumeMixer-CZpOfm8j.js.map
