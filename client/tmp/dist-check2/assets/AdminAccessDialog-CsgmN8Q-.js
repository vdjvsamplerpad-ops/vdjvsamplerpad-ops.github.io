import{r as e,j as s,z as a,A as t,x as i}from"./ui-vendor-DQigaf8h.js";import{c as r,g as n,e as l,D as c,a as d,b as o,d as x,B as m,L as h,I as u,C as j,f as v}from"./index-DlAi4YWJ.js";import{d as p,v as g,R as f,z as y,e as b,m as w,F as N,E as k,n as S,G as _}from"./utils-vendor-Dm3UHTo7.js";import"./react-vendor-ClOJDe5F.js";import"./supabase-vendor-BjTeASSi.js";const C=e.forwardRef(({className:e,...a},t)=>s.jsx("div",{className:"relative w-full overflow-auto",children:s.jsx("table",{ref:t,className:r("w-full caption-bottom text-sm",e),...a})}));C.displayName="Table";const U=e.forwardRef(({className:e,...a},t)=>s.jsx("thead",{ref:t,className:r("[&_tr]:border-b",e),...a}));U.displayName="TableHeader";const D=e.forwardRef(({className:e,...a},t)=>s.jsx("tbody",{ref:t,className:r("[&_tr:last-child]:border-0",e),...a}));D.displayName="TableBody";e.forwardRef(({className:e,...a},t)=>s.jsx("tfoot",{ref:t,className:r("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";const B=e.forwardRef(({className:e,...a},t)=>s.jsx("tr",{ref:t,className:r("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));B.displayName="TableRow";const T=e.forwardRef(({className:e,...a},t)=>s.jsx("th",{ref:t,className:r("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a}));T.displayName="TableHead";const A=e.forwardRef(({className:e,...a},t)=>s.jsx("td",{ref:t,className:r("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a}));A.displayName="TableCell";e.forwardRef(({className:e,...a},t)=>s.jsx("caption",{ref:t,className:r("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption";const P=e.forwardRef(({className:e,...i},n)=>s.jsx(a,{ref:n,className:r("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...i,children:s.jsx(t,{className:r("flex items-center justify-center text-current"),children:s.jsx(p,{className:"h-4 w-4"})})}));P.displayName=a.displayName;const O=e=>{const s=new URLSearchParams;Object.entries(e).forEach(([e,a])=>{null!=a&&""!==a&&s.set(e,String(a))});const a=s.toString();return a?`?${a}`:""},E=async(e,s,a)=>{var t;const i=await n(!0),r=await fetch(l("admin-api",s),{method:e,cache:"no-store",credentials:"omit",headers:{...i,...a?{"Content-Type":"application/json"}:{}},body:a?JSON.stringify(a):void 0}),c=await r.json().catch(()=>({})),d=(null==c?void 0:c.error)||(null==(t=null==c?void 0:c.data)?void 0:t.error);if(!r.ok||!1===(null==c?void 0:c.ok))throw new Error(d||"Admin API request failed");return(null==c?void 0:c.data)??c},R={async listUsers(e){const s=O({q:e.q,page:e.page??1,perPage:e.perPage??1e3,sortBy:e.sortBy??"created_at",sortDir:e.sortDir??"desc",includeAdmins:e.includeAdmins??!1});return E("GET",`users${s}`)},createUser:async e=>E("POST","users/create",e),updateUserProfile:async(e,s)=>E("POST",`users/${e}/update-profile`,s),deleteUser:async e=>E("POST",`users/${e}/delete`),banUser:async(e,s)=>E("POST",`users/${e}/ban`,{hours:s}),unbanUser:async e=>E("POST",`users/${e}/unban`),resetPassword:async e=>E("POST",`users/${e}/reset-password`),async listBanks(e){const s=O({q:e.q,sortBy:e.sortBy??"created_at",sortDir:e.sortDir??"desc"});return E("GET",`banks${s}`)},updateBank:async(e,s)=>E("POST",`banks/${e}/update`,s),deleteBank:async(e,s=!0)=>E("POST",`banks/${e}/delete`,{revokeAll:s}),getUserAccess:async e=>E("GET",`access/user/${e}`),grantUserAccess:async(e,s)=>E("POST",`access/user/${e}/grant`,{bankIds:s}),revokeUserAccess:async(e,s)=>E("POST",`access/user/${e}/revoke`,{bankIds:s}),async listActiveSessions(e){const s=O({q:e.q,limit:e.limit??300,t:Date.now()});return E("GET",`active-sessions${s}`)}},$="vdjv-admin-active-sort",F=[{key:"assignments",label:"Assignments"},{key:"banks",label:"Banks"},{key:"users",label:"Users"},{key:"active",label:"Active"}],L=e=>{if(!(null==e?void 0:e.banned_until))return!1;const s=new Date(e.banned_until).getTime();return!Number.isNaN(s)&&s>Date.now()},q=["Dim Gray","Gray","White","Red","Amber","Orange","Light Yellow","Yellow","Green","Aqua","Blue","Pure Blue","Violet","Purple","Hot Pink","Hot Pink 2","Deep Magenta","Deep Brown 2"].map(e=>v.find(s=>s.name===e)).filter(Boolean).map(e=>({label:e.name,value:e.hex}));function z({notices:e,dismiss:a,theme:t}){return"undefined"==typeof document?null:i.createPortal(s.jsx("div",{className:"fixed top-0 left-0 right-0 z-[2147483647] flex justify-center pointer-events-none",children:s.jsx("div",{className:"w-full max-w-xl px-3",children:e.map(e=>s.jsx("div",{className:"pointer-events-auto mt-3 rounded-lg border px-4 py-2 shadow-lg "+("success"===e.variant?"dark"===t?"bg-green-600/90 border-green-500 text-white":"bg-green-600 border-green-700 text-white":"error"===e.variant?"dark"===t?"bg-red-600/90 border-red-500 text-white":"bg-red-600 border-red-700 text-white":"dark"===t?"bg-gray-800/90 border-gray-700 text-white":"bg-gray-900 border-gray-800 text-white"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-1 text-sm",children:e.message}),s.jsx("button",{className:"text-white/80 hover:text-white",onClick:()=>a(e.id),"aria-label":"Dismiss",children:"Ã—"})]})},e.id))})}),document.body)}const G=({title:e,active:a,direction:t,onClick:i})=>s.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-1 font-medium",children:[e,s.jsx("span",{className:"text-xs opacity-70",children:a?"asc"===t?"^":"v":"*"})]});function I({open:a,onOpenChange:t,theme:i}){const r=e.useCallback(()=>{if("undefined"==typeof window)return{sortBy:"last_seen_at",sortDir:"desc"};try{const e=localStorage.getItem($);if(!e)return{sortBy:"last_seen_at",sortDir:"desc"};const s=JSON.parse(e),a=["user_id","email","device_name","platform","last_seen_at"].includes(s.sortBy)?s.sortBy:"last_seen_at";return{sortBy:a,sortDir:"asc"===s.sortDir?"asc":"desc"}}catch{return{sortBy:"last_seen_at",sortDir:"desc"}}},[]),n=e.useMemo(()=>r(),[r]),[l,v]=e.useState("assignments"),[p,O]=e.useState(""),[E,I]=e.useState(""),{notices:M,pushNotice:H,dismiss:J}=function(){const[s,a]=e.useState([]),t=e.useCallback(e=>{a(s=>s.filter(s=>s.id!==e))},[]);return{notices:s,pushNotice:e.useCallback(e=>{const s="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():String(Date.now()+Math.random());a(a=>[{id:s,...e},...a]),window.setTimeout(()=>t(s),4e3)},[t]),dismiss:t}}(),[K,Y]=e.useState([]),[V,W]=e.useState(!1),[Q,X]=e.useState(""),[Z,ee]=e.useState("created_at"),[se,ae]=e.useState("desc"),[te,ie]=e.useState("created_at"),[re,ne]=e.useState("desc"),[le,ce]=e.useState([]),[de,oe]=e.useState(!1),[xe,me]=e.useState(""),[he,ue]=e.useState("created_at"),[je,ve]=e.useState("desc"),[pe,ge]=e.useState("title"),[fe,ye]=e.useState("asc"),[be,we]=e.useState(""),[Ne,ke]=e.useState(new Set),[Se,_e]=e.useState([]),[Ce,Ue]=e.useState(!1),[De,Be]=e.useState(!1),[Te,Ae]=e.useState(!1),[Pe,Oe]=e.useState({activeUsers:0,activeSessions:0}),[Ee,Re]=e.useState([]),[$e,Fe]=e.useState(n.sortBy),[Le,qe]=e.useState(n.sortDir),[ze,Ge]=e.useState(!1),[Ie,Me]=e.useState(""),[He,Je]=e.useState(""),[Ke,Ye]=e.useState(!1),[Ve,We]=e.useState(""),[Qe,Xe]=e.useState(!1),[Ze,es]=e.useState(!1),[ss,as]=e.useState(null),[ts,is]=e.useState(""),[rs,ns]=e.useState(!1),[ls,cs]=e.useState(!1),[ds,os]=e.useState(24),[xs,ms]=e.useState(!1),[hs,us]=e.useState(!1),[js,vs]=e.useState(!1),[ps,gs]=e.useState(!1),[fs,ys]=e.useState(null),[bs,ws]=e.useState(""),[Ns,ks]=e.useState(""),[Ss,_s]=e.useState("#3b82f6"),[Cs,Us]=e.useState(!1),[Ds,Bs]=e.useState(!1),[Ts,As]=e.useState(null),Ps=e.useMemo(()=>K.find(e=>e.id===be)||null,[K,be]),Os=e.useMemo(()=>new Set(Se.map(e=>e.bank_id)),[Se]),Es=e.useMemo(()=>{const e=[...K].sort((e,s)=>{if("display_name"===te)return String(e.display_name||"").localeCompare(String(s.display_name||""),void 0,{sensitivity:"base"});if("email"===te)return String(e.email||"").localeCompare(String(s.email||""),void 0,{sensitivity:"base"});return(e.created_at?new Date(e.created_at).getTime():0)-(s.created_at?new Date(s.created_at).getTime():0)});return"asc"===re?e:e.reverse()},[K,te,re]),Rs=e.useMemo(()=>{const e=[...le].sort((e,s)=>{if("title"===pe)return String(e.title||"").localeCompare(String(s.title||""),void 0,{sensitivity:"base"});if("status"===pe){return(Os.has(e.id)?1:0)-(Os.has(s.id)?1:0)}return(e.access_count||0)-(s.access_count||0)});return"asc"===fe?e:e.reverse()},[le,pe,fe,Os]),$s=e.useMemo(()=>{const e=new Map;Ee.forEach(s=>{const a=e.get(s.user_id);(!a||new Date(s.last_seen_at).getTime()>new Date(a.last_seen_at).getTime())&&e.set(s.user_id,s)});const s=Array.from(e.values());return s.sort((e,s)=>{if("user_id"===$e)return String(e.user_id||"").localeCompare(String(s.user_id||""),void 0,{sensitivity:"base"});if("email"===$e)return String(e.email||"").localeCompare(String(s.email||""),void 0,{sensitivity:"base"});if("device_name"===$e)return String(e.device_name||"").localeCompare(String(s.device_name||""),void 0,{sensitivity:"base"});if("platform"===$e){const a=[e.platform,e.browser,e.os].filter(Boolean).join(" / "),t=[s.platform,s.browser,s.os].filter(Boolean).join(" / ");return a.localeCompare(t,void 0,{sensitivity:"base"})}return new Date(e.last_seen_at).getTime()-new Date(s.last_seen_at).getTime()}),"asc"===Le?s:s.reverse()},[Ee,$e,Le]);e.useEffect(()=>{p&&(H({variant:"error",message:p}),O(""))},[p,H]),e.useEffect(()=>{E&&(H({variant:"success",message:E}),I(""))},[E,H]);const Fs=e.useCallback(async()=>{W(!0);try{const e=await R.listUsers({q:Q,perPage:1e3,includeAdmins:!1,sortBy:Z,sortDir:se});Y(e.users||[]),O("")}catch(e){O((null==e?void 0:e.message)||"Failed to load users")}finally{W(!1)}},[Q,Z,se]),Ls=e.useCallback(async()=>{oe(!0);try{const e=await R.listBanks({q:xe,sortBy:he,sortDir:je});ce(e.banks||[]),O("")}catch(e){O((null==e?void 0:e.message)||"Failed to load banks")}finally{oe(!1)}},[xe,he,je]),qs=e.useCallback(async e=>{if(e){Ue(!0);try{const s=await R.getUserAccess(e);_e(s.access||[]),O("")}catch(s){O((null==s?void 0:s.message)||"Failed to load access"),_e([])}finally{Ue(!1)}}else _e([])},[]),zs=e.useCallback(async()=>{var e,s;Ae(!0);try{const a=await R.listActiveSessions({limit:300});Oe({activeUsers:Number((null==(e=null==a?void 0:a.counts)?void 0:e.activeUsers)||0),activeSessions:Number((null==(s=null==a?void 0:a.counts)?void 0:s.activeSessions)||0)}),Re((null==a?void 0:a.sessions)||[]),O("")}catch(a){O((null==a?void 0:a.message)||"Failed to load active sessions"),Oe({activeUsers:0,activeSessions:0}),Re([])}finally{Ae(!1)}},[]);e.useEffect(()=>{a&&(O(""),I(""),ke(new Set),Ye(!1),Fs(),Ls(),zs())},[a,Fs,Ls,zs]),e.useEffect(()=>{"undefined"!=typeof window&&localStorage.setItem($,JSON.stringify({sortBy:$e,sortDir:Le}))},[$e,Le]),e.useEffect(()=>{a&&(be?qs(be):_e([]))},[a,be,qs]),e.useEffect(()=>{if(!a)return;const e=window.setInterval(()=>{zs()},3e4);return()=>window.clearInterval(e)},[a,zs]);const Gs=e=>{Z===e?ae(e=>"asc"===e?"desc":"asc"):(ee(e),ae("created_at"===e||"last_sign_in_at"===e?"desc":"asc"))},Is=e=>{he===e?ve(e=>"asc"===e?"desc":"asc"):(ue(e),ve("created_at"===e||"access_count"===e?"desc":"asc"))},Ms=e=>{te!==e?(ie(e),ne("created_at"===e?"desc":"asc")):ne(e=>"asc"===e?"desc":"asc")},Hs=e=>{pe!==e?(ge(e),ye("access_count"===e?"desc":"asc")):ye(e=>"asc"===e?"desc":"asc")},Js=e=>{$e!==e?(Fe(e),qe("last_seen_at"===e?"desc":"asc")):qe(e=>"asc"===e?"desc":"asc")},Ks=Array.from(Ne),Ys=Ks.filter(e=>!Os.has(e)),Vs=Ks.filter(e=>Os.has(e)),Ws=le.filter(e=>!Os.has(e.id)).map(e=>e.id),Qs=le.filter(e=>Os.has(e.id)).map(e=>e.id),Xs=async e=>{if(be&&0!==e.length){Be(!0);try{await R.grantUserAccess(be,e),I(`Granted ${e.length} bank(s).`),ke(new Set),await Promise.all([qs(be),Ls()]),O("")}catch(s){O((null==s?void 0:s.message)||"Grant failed")}finally{Be(!1)}}},Zs=async e=>{if(be&&0!==e.length){Be(!0);try{await R.revokeUserAccess(be,e),I(`Revoked ${e.length} bank(s).`),ke(new Set),await Promise.all([qs(be),Ls()]),O("")}catch(s){O((null==s?void 0:s.message)||"Revoke failed")}finally{Be(!1)}}};return s.jsxs(s.Fragment,{children:[s.jsx(z,{notices:M,dismiss:J,theme:i}),s.jsx(c,{open:a,onOpenChange:t,children:s.jsxs(d,{"aria-describedby":void 0,className:"w-[95vw] max-w-6xl h-[90vh] max-h-[90vh] overflow-hidden grid grid-rows-[auto_1fr] "+("dark"===i?"bg-gray-900 text-white":"bg-white text-gray-900"),children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(g,{className:"w-4 h-4"}),"Admin Access"]})}),s.jsxs("div",{className:"space-y-3 min-h-0 h-full overflow-hidden flex flex-col",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:F.map(e=>s.jsx(m,{size:"sm",variant:l===e.key?"default":"outline",onClick:()=>v(e.key),children:e.label},e.key))}),"assignments"===l&&s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 h-full min-h-0 overflow-hidden",children:[s.jsxs("div",{className:"border rounded p-3 space-y-2 min-h-0 flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(h,{children:"Select User"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(m,{size:"sm",variant:"created_at"===te?"secondary":"outline",onClick:()=>Ms("created_at"),children:"Newest"}),s.jsx(m,{size:"sm",variant:"outline",onClick:()=>{Fs()},disabled:V,children:s.jsx(f,{className:"w-4 h-4 "+(V?"animate-spin":"")})})]})]}),s.jsx(u,{value:Q,onChange:e=>X(e.target.value),placeholder:"Search users...",onKeyDown:e=>"Enter"===e.key&&void Fs()}),s.jsx("div",{className:"flex-1 min-h-0 overflow-auto border rounded",children:s.jsxs(C,{className:"table-fixed",children:[s.jsx(U,{children:s.jsxs(B,{children:[s.jsx(T,{children:s.jsx(G,{title:"User",active:"display_name"===te,direction:re,onClick:()=>Ms("display_name")})}),s.jsx(T,{children:s.jsx(G,{title:"Email",active:"email"===te,direction:re,onClick:()=>Ms("email")})})]})}),s.jsxs(D,{children:[Es.map(e=>s.jsxs(B,{className:"cursor-pointer "+(be===e.id?"dark"===i?"bg-gray-800":"bg-gray-100":""),onClick:()=>we(e.id),children:[s.jsx(A,{className:"max-w-[200px] truncate",title:e.display_name,children:e.display_name}),s.jsx(A,{className:"max-w-[220px] truncate",title:e.email||"",children:e.email||"-"})]},e.id)),!V&&0===Es.length&&s.jsx(B,{children:s.jsx(A,{colSpan:2,className:"text-center py-3 opacity-70",children:"No users"})})]})]})})]}),s.jsxs("div",{className:"border rounded p-3 space-y-2 min-h-0 flex flex-col",children:[s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"font-medium",children:"Bank Access"}),s.jsx("div",{className:"text-xs opacity-70",children:Ce?"Loading access...":Ps?`${Ps.display_name} (${Ps.email||"no email"})`:"Select a user first"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(m,{size:"sm",onClick:()=>{Xs(Ys)},disabled:!be||0===Ys.length||De,children:["Grant Selected (",Ys.length,")"]}),s.jsxs(m,{size:"sm",variant:"outline",onClick:()=>{Zs(Vs)},disabled:!be||0===Vs.length||De,children:["Revoke Selected (",Vs.length,")"]}),s.jsxs(m,{size:"sm",variant:"secondary",onClick:()=>{Xs(Ws)},disabled:!be||0===Ws.length||De,children:["Grant All (",Ws.length,")"]}),s.jsxs(m,{size:"sm",variant:"outline",onClick:()=>{Zs(Qs)},disabled:!be||0===Qs.length||De,children:["Revoke All (",Qs.length,")"]})]}),s.jsx("div",{className:"flex-1 min-h-0 overflow-auto border rounded",children:s.jsxs(C,{className:"table-fixed",children:[s.jsx(U,{children:s.jsxs(B,{children:[s.jsx(T,{className:"w-10"}),s.jsx(T,{children:s.jsx(G,{title:"Bank",active:"title"===pe,direction:fe,onClick:()=>Hs("title")})}),s.jsx(T,{children:s.jsx(G,{title:"Status",active:"status"===pe,direction:fe,onClick:()=>Hs("status")})}),s.jsx(T,{children:s.jsx(G,{title:"Access",active:"access_count"===pe,direction:fe,onClick:()=>Hs("access_count")})})]})}),s.jsxs(D,{children:[Rs.map(e=>{const a=Os.has(e.id);return s.jsxs(B,{children:[s.jsx(A,{children:s.jsx(P,{checked:Ne.has(e.id),onCheckedChange:()=>{return s=e.id,void ke(e=>{const a=new Set(e);return a.has(s)?a.delete(s):a.add(s),a});var s},disabled:!be})}),s.jsxs(A,{children:[s.jsx("div",{className:"font-medium truncate max-w-[240px]",title:e.title,children:e.title}),s.jsx("div",{className:"text-xs opacity-70 truncate max-w-[240px]",title:e.description||"",children:e.description||"-"})]}),s.jsx(A,{children:s.jsx("span",{className:"text-xs px-2 py-1 rounded "+(a?"bg-emerald-600/20 text-emerald-500":"bg-gray-600/20 text-gray-500"),children:a?"Granted":"Not granted"})}),s.jsx(A,{children:e.access_count})]},e.id)}),!de&&0===Rs.length&&s.jsx(B,{children:s.jsx(A,{colSpan:4,className:"text-center py-3 opacity-70",children:"No banks"})})]})]})})]})]}),"banks"===l&&s.jsxs("div",{className:"border rounded p-3 space-y-2 h-full min-h-0 flex flex-col overflow-hidden",children:[s.jsxs("div",{className:"flex gap-2 items-end",children:[s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsx(h,{children:"Search Banks"}),s.jsx(u,{value:xe,onChange:e=>me(e.target.value),placeholder:"Search title or description...",onKeyDown:e=>"Enter"===e.key&&void Ls()})]}),s.jsxs(m,{variant:"outline",onClick:()=>{Ls()},disabled:de,children:[s.jsx(f,{className:"w-4 h-4 mr-1 "+(de?"animate-spin":"")}),"Refresh"]})]}),s.jsx("div",{className:"flex-1 min-h-0 overflow-auto border rounded",children:s.jsxs(C,{children:[s.jsx(U,{children:s.jsxs(B,{children:[s.jsx(T,{children:"Color"}),s.jsx(T,{children:s.jsx(G,{title:"Title",active:"title"===he,direction:je,onClick:()=>Is("title")})}),s.jsx(T,{children:"Description"}),s.jsx(T,{children:s.jsx(G,{title:"Created",active:"created_at"===he,direction:je,onClick:()=>Is("created_at")})}),s.jsx(T,{children:s.jsx(G,{title:"Access",active:"access_count"===he,direction:je,onClick:()=>Is("access_count")})}),s.jsx(T,{className:"text-right",children:"Actions"})]})}),s.jsxs(D,{children:[le.map(e=>s.jsxs(B,{children:[s.jsx(A,{children:s.jsx("span",{className:"inline-block w-5 h-5 rounded border",style:{backgroundColor:e.color||"#3b82f6"}})}),s.jsx(A,{children:e.title}),s.jsx(A,{className:"max-w-[280px] truncate",title:e.description||"",children:e.description||"-"}),s.jsx(A,{children:e.created_at?new Date(e.created_at).toLocaleString():"-"}),s.jsx(A,{children:e.access_count}),s.jsxs(A,{className:"text-right space-x-2",children:[s.jsx(m,{size:"sm",variant:"outline",onClick:()=>{ys(e),ws(e.title),ks(e.description||""),_s(e.color||"#3b82f6"),gs(!0)},children:s.jsx(y,{className:"w-4 h-4"})}),s.jsx(m,{size:"sm",variant:"destructive",onClick:()=>{As(e),Bs(!0)},children:s.jsx(b,{className:"w-4 h-4"})})]})]},e.id)),!de&&0===le.length&&s.jsx(B,{children:s.jsx(A,{colSpan:6,className:"text-center py-3 opacity-70",children:"No banks"})})]})]})})]}),"users"===l&&s.jsxs("div",{className:"border rounded p-3 space-y-2 h-full min-h-0 flex flex-col overflow-hidden",children:[s.jsxs("div",{className:"flex gap-2 items-end",children:[s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsx(h,{children:"Search Users"}),s.jsx(u,{value:Q,onChange:e=>X(e.target.value),placeholder:"Search name, email, id...",onKeyDown:e=>"Enter"===e.key&&void Fs()})]}),s.jsxs(m,{onClick:()=>Ge(!0),children:[s.jsx(w,{className:"w-4 h-4 mr-1"}),"Add User"]}),s.jsxs(m,{variant:"outline",onClick:()=>{Fs()},disabled:V,children:[s.jsx(f,{className:"w-4 h-4 mr-1 "+(V?"animate-spin":"")}),"Refresh"]})]}),s.jsx("div",{className:"flex-1 min-h-0 overflow-auto border rounded",children:s.jsxs(C,{children:[s.jsx(U,{children:s.jsxs(B,{children:[s.jsx(T,{children:s.jsx(G,{title:"Display Name",active:"display_name"===Z,direction:se,onClick:()=>Gs("display_name")})}),s.jsx(T,{children:s.jsx(G,{title:"Email",active:"email"===Z,direction:se,onClick:()=>Gs("email")})}),s.jsx(T,{children:s.jsx(G,{title:"Created",active:"created_at"===Z,direction:se,onClick:()=>Gs("created_at")})}),s.jsx(T,{children:s.jsx(G,{title:"Last Sign-In",active:"last_sign_in_at"===Z,direction:se,onClick:()=>Gs("last_sign_in_at")})}),s.jsx(T,{children:s.jsx(G,{title:"Ban Status",active:"ban_status"===Z,direction:se,onClick:()=>Gs("ban_status")})}),s.jsx(T,{className:"text-right",children:"Actions"})]})}),s.jsxs(D,{children:[K.map(e=>s.jsxs(B,{children:[s.jsx(A,{children:e.display_name}),s.jsx(A,{children:e.email||"-"}),s.jsx(A,{children:e.created_at?new Date(e.created_at).toLocaleString():"-"}),s.jsx(A,{children:e.last_sign_in_at?new Date(e.last_sign_in_at).toLocaleString():"-"}),s.jsx(A,{children:s.jsx("span",{className:"text-xs px-2 py-1 rounded "+(L(e)?"bg-red-600/20 text-red-500":"bg-emerald-600/20 text-emerald-500"),children:L(e)?"Banned":"Active"})}),s.jsx(A,{className:"text-right",children:s.jsx(m,{size:"sm",variant:"outline",onClick:()=>{return as(s=e),is(s.display_name||""),os(24),void es(!0);var s},children:"Edit"})})]},e.id)),!V&&0===K.length&&s.jsx(B,{children:s.jsx(A,{colSpan:6,className:"text-center py-3 opacity-70",children:"No users"})})]})]})})]}),"active"===l&&s.jsxs("div",{className:"border rounded p-3 space-y-2 h-full min-h-0 flex flex-col overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx(h,{children:"Active Users"}),s.jsx("div",{className:"text-xs opacity-70",children:"Non-admin users currently online."})]}),s.jsxs(m,{variant:"outline",onClick:()=>{zs()},disabled:Te,children:[s.jsx(f,{className:"w-4 h-4 mr-1 "+(Te?"animate-spin":"")}),"Refresh"]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{className:"border rounded p-3 "+("dark"===i?"border-gray-700 bg-gray-800":"border-gray-200 bg-gray-50"),children:[s.jsx("div",{className:"text-xs opacity-70",children:"Active Users"}),s.jsx("div",{className:"text-xl font-semibold",children:Pe.activeUsers})]}),s.jsxs("div",{className:"border rounded p-3 "+("dark"===i?"border-gray-700 bg-gray-800":"border-gray-200 bg-gray-50"),children:[s.jsx("div",{className:"text-xs opacity-70",children:"Active Sessions"}),s.jsx("div",{className:"text-xl font-semibold",children:Pe.activeSessions})]})]}),s.jsx("div",{className:"flex-1 min-h-0 overflow-auto border rounded",children:s.jsxs(C,{children:[s.jsx(U,{children:s.jsxs(B,{children:[s.jsx(T,{children:s.jsx(G,{title:"User",active:"user_id"===$e,direction:Le,onClick:()=>Js("user_id")})}),s.jsx(T,{children:s.jsx(G,{title:"Email",active:"email"===$e,direction:Le,onClick:()=>Js("email")})}),s.jsx(T,{children:s.jsx(G,{title:"Device Name",active:"device_name"===$e,direction:Le,onClick:()=>Js("device_name")})}),s.jsx(T,{children:s.jsx(G,{title:"Platform / Browser / OS",active:"platform"===$e,direction:Le,onClick:()=>Js("platform")})}),s.jsx(T,{children:s.jsx(G,{title:"Last Seen",active:"last_seen_at"===$e,direction:Le,onClick:()=>Js("last_seen_at")})})]})}),s.jsxs(D,{children:[$s.map(e=>s.jsxs(B,{children:[s.jsxs(A,{className:"font-mono text-xs",children:[e.user_id.slice(0,8),"..."]}),s.jsx(A,{children:e.email||"-"}),s.jsx(A,{children:e.device_name||"-"}),s.jsx(A,{children:[e.platform,e.browser,e.os].filter(Boolean).join(" / ")||"-"}),s.jsx(A,{children:new Date(e.last_seen_at).toLocaleString()})]},e.user_id)),!Te&&0===$s.length&&s.jsx(B,{children:s.jsx(A,{colSpan:5,className:"text-center py-3 opacity-70",children:"No active users"})})]})]})})]})]})]})}),s.jsx(c,{open:ze,onOpenChange:Ge,useHistory:!1,children:s.jsxs(d,{"aria-describedby":void 0,className:"dark"===i?"bg-gray-900 text-white":"bg-white text-gray-900",children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(N,{className:"w-4 h-4"}),"Add User"]})}),s.jsxs("form",{className:"space-y-2",onSubmit:e=>{e.preventDefault(),(async()=>{const e=Ie.trim().toLowerCase();if(e)if(!He||He.length<6)O("Password must be at least 6 characters.");else{Xe(!0);try{await R.createUser({email:e,password:He,displayName:Ve.trim()||void 0}),Me(""),Je(""),We(""),Ge(!1),I("User created."),await Fs(),O("")}catch(s){O((null==s?void 0:s.message)||"Failed to create user")}finally{Xe(!1)}}else O("Email is required.")})()},children:[s.jsxs("div",{children:[s.jsx(h,{children:"Email"}),s.jsx(u,{type:"email",autoComplete:"email",value:Ie,onChange:e=>Me(e.target.value),placeholder:"user@example.com"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx(h,{children:"Password"}),s.jsxs("div",{className:"relative",children:[s.jsx(u,{type:Ke?"text":"password",value:He,onChange:e=>Je(e.target.value),placeholder:"Minimum 6 characters",autoComplete:"new-password"}),s.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-800",onClick:()=>Ye(e=>!e),"aria-label":Ke?"Hide password":"Show password",children:Ke?s.jsx(k,{className:"w-4 h-4"}):s.jsx(S,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{children:[s.jsx(h,{children:"Display Name"}),s.jsx(u,{value:Ve,onChange:e=>We(e.target.value),placeholder:"Optional"})]}),s.jsx("div",{className:"text-xs opacity-70",children:"User is auto-confirmed."}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(m,{type:"submit",className:"flex-1",disabled:Qe,children:Qe?"Creating...":"Create User"}),s.jsx(m,{type:"button",variant:"outline",onClick:()=>Ge(!1),children:"Cancel"})]})]})]})}),s.jsx(c,{open:Ze,onOpenChange:es,useHistory:!1,children:s.jsxs(d,{"aria-describedby":void 0,className:"dark"===i?"bg-gray-900 text-white":"bg-white text-gray-900",children:[s.jsx(o,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(_,{className:"w-4 h-4"}),"User Details"]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx(h,{children:"Display Name"}),s.jsx(u,{value:ts,onChange:e=>is(e.target.value)})]}),s.jsxs("div",{children:[s.jsx(h,{children:"Email"}),s.jsx("div",{children:(null==ss?void 0:ss.email)||"-"})]}),s.jsxs("div",{children:[s.jsx(h,{children:"UID"}),s.jsx("div",{className:"font-mono text-xs break-all",children:(null==ss?void 0:ss.id)||"-"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx(h,{children:"Created"}),s.jsx("div",{children:(null==ss?void 0:ss.created_at)?new Date(ss.created_at).toLocaleString():"-"})]}),s.jsxs("div",{children:[s.jsx(h,{children:"Last Sign-In"}),s.jsx("div",{children:(null==ss?void 0:ss.last_sign_in_at)?new Date(ss.last_sign_in_at).toLocaleString():"-"})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(m,{className:"flex-1",disabled:rs,onClick:async()=>{if(!ss)return;const e=ts.trim();if(e){ns(!0);try{await R.updateUserProfile(ss.id,{displayName:e}),as(s=>s?{...s,display_name:e}:s),I("User profile updated."),await Fs(),be&&await qs(be),es(!1),O("")}catch(s){O((null==s?void 0:s.message)||"Failed to update profile")}finally{ns(!1)}}else O("Display name is required.")},children:rs?"Saving...":"Save Profile"}),s.jsx(m,{variant:"outline",className:"flex-1",onClick:()=>vs(!0),children:"Send Password Reset"})]}),s.jsxs("div",{className:"flex gap-2",children:[L(ss)?s.jsx(m,{variant:"outline",className:"flex-1",onClick:()=>us(!0),children:"Unban User"}):s.jsx(m,{variant:"outline",className:"flex-1",onClick:()=>cs(!0),children:"Ban User"}),s.jsx(m,{variant:"destructive",className:"flex-1",onClick:()=>ms(!0),children:"Delete User"})]})]})]})}),s.jsx(c,{open:ls,onOpenChange:cs,useHistory:!1,children:s.jsxs(d,{"aria-describedby":void 0,className:"dark"===i?"bg-gray-900 text-white":"bg-white text-gray-900",children:[s.jsx(o,{children:s.jsx(x,{children:"Ban User"})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx(h,{children:"Ban Duration (hours)"}),s.jsx(u,{type:"number",min:1,max:8760,value:ds,onChange:e=>os(Math.max(1,Math.min(8760,Number(e.target.value)||24)))})]}),s.jsxs("div",{className:"text-xs opacity-70",children:["Ban until: ",new Date(Date.now()+60*ds*60*1e3).toLocaleString()]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(m,{variant:"destructive",className:"flex-1",onClick:async()=>{if(ss)try{const e=await R.banUser(ss.id,ds);as(s=>s?{...s,banned_until:e.banned_until||s.banned_until}:s),cs(!1),I(`User banned for ${ds} hour(s).`),await Fs(),O("")}catch(e){O((null==e?void 0:e.message)||"Failed to ban user")}},children:"Ban User"}),s.jsx(m,{variant:"outline",onClick:()=>cs(!1),children:"Cancel"})]})]})]})}),s.jsx(c,{open:ps,onOpenChange:gs,useHistory:!1,children:s.jsxs(d,{"aria-describedby":void 0,className:"dark"===i?"bg-gray-900 text-white":"bg-white text-gray-900",children:[s.jsx(o,{children:s.jsx(x,{children:"Edit Bank"})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx(h,{children:"Title"}),s.jsx(u,{value:bs,onChange:e=>ws(e.target.value)})]}),s.jsxs("div",{children:[s.jsx(h,{children:"Description"}),s.jsx("textarea",{className:"w-full min-h-[120px] rounded border p-2 "+("dark"===i?"bg-gray-800 border-gray-700":"bg-white border-gray-300"),value:Ns,onChange:e=>ks(e.target.value)})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx(h,{children:"Bank Color"}),s.jsx("div",{className:"flex flex-wrap gap-1",children:q.map(e=>s.jsx("button",{type:"button",title:e.label,className:"w-6 h-6 rounded-full border-2 "+(Ss===e.value?"border-white scale-110":"border-gray-500"),style:{backgroundColor:e.value},onClick:()=>_s(e.value)},e.value))})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(m,{className:"flex-1",disabled:Cs,onClick:async()=>{if(!fs)return;const e=bs.trim();if(e){Us(!0);try{await R.updateBank(fs.id,{title:e,description:Ns.trim(),color:Ss}),I("Bank updated."),gs(!1),await Ls(),O("")}catch(s){O((null==s?void 0:s.message)||"Failed to update bank")}finally{Us(!1)}}else O("Bank title is required.")},children:Cs?"Saving...":"Save"}),s.jsx(m,{variant:"outline",onClick:()=>gs(!1),children:"Cancel"})]})]})]})}),s.jsx(j,{open:xs,onOpenChange:ms,title:"Delete User",description:"This will permanently delete the user account. This action cannot be undone.",confirmText:"Delete User",variant:"destructive",onConfirm:async()=>{if(ss)try{await R.deleteUser(ss.id),ms(!1),es(!1),be===ss.id&&we(""),I("User deleted."),await Promise.all([Fs(),Ls()]),O("")}catch(e){O((null==e?void 0:e.message)||"Failed to delete user")}},theme:i}),s.jsx(j,{open:hs,onOpenChange:us,title:"Unban User",description:`Unban "${(null==ss?void 0:ss.display_name)||(null==ss?void 0:ss.email)||"this user"}"?`,confirmText:"Unban User",onConfirm:async()=>{if(ss)try{await R.unbanUser(ss.id),as(e=>e?{...e,banned_until:null}:e),I("User unbanned."),await Fs(),O("")}catch(e){O((null==e?void 0:e.message)||"Failed to unban user")}},theme:i}),s.jsx(j,{open:js,onOpenChange:vs,title:"Send Password Reset",description:`Send password reset email to "${(null==ss?void 0:ss.email)||"this user"}"?`,confirmText:"Send Reset",onConfirm:async()=>{if(ss)try{await R.resetPassword(ss.id),I("Password reset email sent."),O("")}catch(e){O((null==e?void 0:e.message)||"Failed to send reset email")}},theme:i}),s.jsx(j,{open:Ds,onOpenChange:Bs,title:"Delete Bank",description:`Delete "${(null==Ts?void 0:Ts.title)||"this bank"}" and revoke all user access?`,confirmText:"Delete Bank",variant:"destructive",onConfirm:async()=>{if(Ts)try{await R.deleteBank(Ts.id,!0),I(`Bank "${Ts.title}" deleted and access revoked.`),Bs(!1),As(null),await Promise.all([Ls(),be?qs(be):Promise.resolve()]),O("")}catch(e){O((null==e?void 0:e.message)||"Failed to delete bank")}},theme:i})]})}export{I as AdminAccessDialog};
//# sourceMappingURL=AdminAccessDialog-CsgmN8Q-.js.map
